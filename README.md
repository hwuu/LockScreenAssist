# 语伴（YuBan）

一个优雅的名言壁纸应用，为您的每一天带来智慧与灵感。应用精选古今中外的名言警句，结合智能算法和精美设计，让您的手机屏幕成为心灵的窗口。

## 核心理念

- **智慧相伴**：精选名言警句，陪伴您的生活与成长
- **美学设计**：简约优雅的界面，赏心悦目的视觉体验
- **智能推荐**：根据时间、季节智能推送合适的内容
- **个性定制**：丰富的自定义选项，打造专属体验

## 功能特性

### 🕐 定时更新
- **多种频率选择**：支持每小时、每2小时、每4小时、每6小时、每12小时更新
- **定点更新**：支持每天特定时间更新（上午8点、中午12点、下午6点）
- **Crontab格式**：支持类似 Linux crontab 的时间表达式，精确到小时
- **后台运行**：即使应用不在前台，也能自动更新壁纸

### 🤖 智能选择算法
1. **随机选择**：从所有名言中随机选择
2. **根据季节**：根据当前季节选择相应的名言（春夏秋冬）
3. **根据天气**：根据天气情况选择匹配的名言（晴天、雨天、雪天等）
4. **智能选择**：综合考虑时间、季节、天气等因素，智能评分选择最合适的名言

### 🎨 自动优化
- **字体大小自适应**：根据名言长度自动调整字体大小，确保显示完整
- **背景色彩优化**：根据名言类别、季节、天气自动选择最佳配色方案
- **渐变背景**：支持美观的渐变色背景，提升视觉效果
- **文字对比度**：自动调整文字颜色确保良好的可读性

### 📱 用户界面
- **沉浸式预览**：全屏展示壁纸效果，所见即所得
- **极简操作**：
  - 上下滑动切换名言
  - 长按保存到图库
  - 右上角快捷按钮控制播放
- **智能提示**：呼吸灯效果的操作提示，不打扰的引导体验
- **毛玻璃按钮**：半透明背景虚化效果，与壁纸完美融合
- **响应式设计**：自适应不同屏幕尺寸和方向

### ▶️ 自动播放功能
- **优雅动画**：7阶段精细动画控制，流畅自然的视觉过渡
  - 完整显示 (IDLE)
  - 文字淡出 (TEXT_FADE_OUT)
  - 文字消失保持 (TEXT_OUT_HOLD)
  - 背景淡出 (BG_FADE_OUT)
  - 背景淡入 (BG_FADE_IN)
  - 文字出现保持 (TEXT_IN_HOLD)
  - 文字淡入 (TEXT_FADE_IN)
- **智能过渡**：
  - 背景采用层叠混合技术，实现50%透明度的平滑过渡
  - 文字与背景动画精确同步
  - 首次播放快速启动（1秒后开始）
  - 进度圈圈显示剩余时间，与背景动画同步淡入淡出
- **动态时间配置**：
  - 完整显示：根据文字长度动态调整（10字以下5秒，每增加1字增加0.2秒，最多30秒）
  - 文字动画：1秒淡入/淡出
  - 背景过渡：0.5秒
  - 保持时间：0.25秒
- **智能控制**：
  - 程序启动时自动开始播放
  - 暂停时10倍速快进到下一个完整显示状态
  - 播放期间禁用手势，专注观看体验
  - 进度圈圈实时显示播放进度
  - 加载动画提示操作状态

## ⚠️ 重要说明 - 壁纸设置限制

### 官方政策变更

根据华为官方文档说明：

> **从API 9开始壁纸的切换只能通过系统应用来完成**。壁纸管理提供壁纸切换通道，使用壁纸的应用（如：桌面）需订阅壁纸变化通知并刷新壁纸显示。系统提供的壁纸接口在API 9之后已废弃。

### 当前解决方案

1. **自动设置锁屏壁纸功能已被禁用**
   - 应用无法直接调用系统API设置锁屏壁纸
   - 在"应用壁纸"对话框中，该选项已变灰处理

2. **推荐的使用流程**
   - 在应用中生成和预览壁纸
   - 长按屏幕选择"保存到系统图库"将壁纸保存至图库
   - 手动进入系统设置 → 显示和亮度 → 壁纸 → 从图库选择刚保存的壁纸

### 技术细节

- `wallpaper.setWallpaper()` API从API 9开始无法在三方应用中正常工作
- 目前正确的做法是保存图片至系统图库后，引导用户手工设置锁屏壁纸
- 可以通过Want拉起系统设置页面，但仍需用户手动操作

**参考资料**：
- [HarmonyOS壁纸管理官方文档](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-wallpaper)
- [开发者论坛 - 壁纸设置限制说明](https://developer.huawei.com/consumer/cn/forum/topic/0201174673303692458)

## 安装要求

- **系统版本**：HarmonyOS 5.1.1 或以上
- **设备类型**：手机
- **权限需求**：
  - ~~设置壁纸权限~~（已禁用）
  - 图库写入权限（保存图片）
  - 网络访问权限（获取天气信息，可选）

## 使用方法

### 1. 基本使用
1. 安装并启动应用
2. 应用会自动生成第一张名言壁纸并显示预览
3. 上下滑动可以浏览更多名言
4. 长按屏幕选择"保存到系统图库"
5. 手动进入系统设置设置壁纸

### 2. 个性化设置
1. 点击左上角⋯按钮进入设置页面
2. 选择更新频率（默认每6小时）
3. 选择选择算法（推荐智能选择）
4. 开启或关闭自动优化功能
5. 点击"保存设置"

### 3. 手动操作
- 上下滑动切换不同名言
- 长按屏幕保存喜欢的壁纸到图库（需要授予存储权限）

### 4. 自动播放
- 点击右上角播放按钮开始自动轮播
- 播放时会禁用滑动和长按手势
- 点击暂停按钮会10倍速快进到下一个完整显示

## 运行机制

### 应用生命周期
应用采用HarmonyOS标准的生命周期管理：

1. **EntryAbility**：应用主入口，负责应用的启动和生命周期管理
2. **页面导航**：支持主页面和设置页面之间的导航
3. **状态保持**：应用在前台运行时维护壁纸更新状态
4. **数据备份**：EntryBackupAbility提供应用数据的备份和恢复功能

### 权限要求
应用需要以下系统权限：
- 图库写入权限：用于保存壁纸到系统图库
- 网络访问权限：获取天气信息用于智能选择（可选）

## 名言数据库

应用内置丰富的名言警句数据库，包含：

### 分类
- **励志类**：激励人心的名言，适合早晨和工作时间
- **智慧类**：充满智慧的格言，适合学习和思考
- **诗词类**：优美的诗词名句，适合休闲时光
- **哲理类**：富含哲理的句子，适合深度思考

### 季节适配
- **春**：描写春天的诗词和积极向上的名言
- **夏**：适合夏日的清新励志句子
- **秋**：秋季收获和感悟相关的名言
- **冬**：冬日坚韧和温暖的句子

### 天气适配
- **晴天**：阳光积极的名言
- **雨天**：关于坚持和希望的句子
- **雪天**：关于纯洁和坚韧的名言

## 技术架构

### 核心模块
1. **QuoteData**：名言数据管理
2. **QuoteDataSource**：LazyForEach数据源，支持大量数据懒加载
3. **ScheduleConfig**：定时任务配置
4. **QuoteSelectionService**：名言选择服务
5. **WallpaperService**：壁纸生成服务
6. **AutoPlayService**：自动播放状态机管理（7状态精细控制）
7. **HintAnimationService**：提示动画服务（呼吸灯效果）
8. **WallpaperUIService**：壁纸UI更新服务
9. **QuotePageService**：名言页面管理服务

### 设计模式
- **服务层架构**：清晰的分层设计
- **配置驱动**：所有功能都支持配置化
- **策略模式**：选择算法可插拔
- **状态机模式**：AutoPlayService使用7状态精细控制动画流程
- **数据驱动**：基于数据结构的壁纸生成

### 技术特点
- **HarmonyOS 5.1.1**：基于最新鸿蒙系统开发
- **ArkTS**：使用声明式UI框架
- **模块化设计**：清晰的代码组织结构
- **类型安全**：完整的TypeScript类型支持

## 开发说明

### 项目结构
```
entry/src/main/ets/
├── common/                    # 公共模块
│   ├── QuoteData.ets         # 名言数据管理
│   ├── QuoteDataSource.ets   # LazyForEach数据源
│   ├── ScheduleConfig.ets    # 定时任务配置
│   ├── UIConstants.ets       # UI常量定义
│   └── TextLayoutTypes.ets   # 文本布局类型定义
├── services/                  # 服务层
│   ├── QuoteSelectionService.ets  # 智能名言选择服务
│   ├── WallpaperService.ets      # 壁纸生成与应用服务
│   ├── AutoPlayService.ets       # 自动播放状态机管理
│   ├── HintAnimationService.ets  # 提示动画服务
│   ├── WallpaperUIService.ets    # 壁纸UI更新服务
│   ├── QuotePageService.ets      # 名言页面管理服务
│   └── AppInitializationService.ets # 应用初始化服务
├── components/               # UI组件
│   ├── TopBarComponent.ets  # 顶部工具栏组件（包含设置和播放按钮）
│   ├── QuoteSwiperComponent.ets # 名言滑动组件
│   ├── HintTextComponent.ets # 提示文本组件（呼吸灯效果）
│   ├── LoadingOverlayComponent.ets # 加载遮罩组件
│   └── PlayControlButton.ets # 独立播放按钮组件（备用）
├── pages/                     # 页面层
│   ├── Index.ets             # 主页面
│   └── Settings.ets          # 设置页面
├── entryability/             # 应用能力
│   └── EntryAbility.ets      # 应用生命周期管理
└── entrybackupability/       # 备份能力
    └── EntryBackupAbility.ets # 数据备份恢复
```

### 构建配置
- **oh-package.json5**：依赖管理和项目配置
- **build-profile.json5**：构建配置和编译选项
- **code-linter.json5**：代码质量检查配置

### 扩展开发
1. **添加新名言**：在 `QuoteData.ets` 中添加新的名言数据
2. **自定义算法**：在 `QuoteSelectionService.ets` 中实现新的选择算法
3. **样式定制**：在 `WallpaperService.ets` 中修改样式生成逻辑
4. **新增页面**：在 `pages/` 目录下添加新的功能页面
5. **数据管理**：扩展 `ScheduleConfig.ets` 支持新的配置选项

## 开发指南

### 开发环境要求
- **DevEco Studio**：4.1.1或更高版本
- **HarmonyOS SDK**：API版本 12 或更高
- **Node.js**：用于构建工具链
- **ArkTS/TypeScript**：主要开发语言

### 构建和运行
```bash
# 清理项目
hvigorw clean

# 构建项目
hvigorw assembleHap

# 预览模式构建
hvigorw --mode module -p module=entry@default -p product=default PreviewBuild
```

### 代码质量
项目配置了完整的代码质量检查工具：
- **ESLint**：通过 code-linter.json5 配置
- **TypeScript检查**：严格的类型检查
- **代码格式化**：通过 .clang-format 配置

## 常见问题

### Q: 为什么不能直接设置锁屏壁纸了？
A: 从HarmonyOS API 9开始，华为官方限制三方应用直接设置系统壁纸。需要将图片保存到图库后手动设置。这是系统安全策略的要求。

### Q: 如何添加自定义名言？
A: 开发者可以通过修改 `QuoteData.ets` 文件来添加新的名言数据，按照现有的数据结构格式添加即可。

### Q: 壁纸文字显示不完整怎么办？
A: 检查 `WallpaperService.ets` 中的字体大小自适应逻辑，可以调整字体大小计算算法或最小字体大小限制。

### Q: 如何修改壁纸样式？
A: 在 `WallpaperService.ets` 中可以修改背景色彩、渐变效果、文字排版等样式参数。

### Q: 构建失败怎么办？
A:
1. 检查DevEco Studio版本和SDK版本是否符合要求
2. 清理项目缓存：`hvigorw clean`
3. 重新安装依赖：删除oh_modules目录后重新构建
4. 检查代码语法错误和类型错误

## 项目特色

### 🚀 技术亮点
- **原生HarmonyOS应用**：完全基于HarmonyOS 5.1.1开发
- **ArkTS声明式UI**：使用最新的声明式UI框架
- **智能算法驱动**：多种智能选择算法确保内容的丰富性和适应性
- **高性能渲染**：优化的图像生成和壁纸应用流程
- **模块化架构**：清晰的代码组织和良好的可扩展性

### 🎯 设计理念
- **用户体验优先**：简洁直观的界面设计
- **智能化自动化**：减少用户操作，智能推荐合适内容
- **个性化定制**：丰富的配置选项满足不同用户需求
- **性能与美观并重**：在保证性能的前提下提供精美的视觉效果

## 版本历史

### v2.1.0 (当前版本) - 2025年1月
- ✅ 程序启动时自动开始播放
- ✅ 根据文字长度动态调整播放时长
- ✅ 进度圈圈显示播放进度，与背景动画同步淡入淡出
- ✅ 修复保存图片功能，添加运行时权限请求
- ✅ 修复长按手势在播放暂停后失效的问题
- ✅ 优化截图组件的渲染方式，确保图片正确保存

### v2.0.0 - 2025年1月
- ✅ 全新的7阶段精细动画系统
- ✅ 优化播放控制逻辑，支持快速启动和10倍速暂停
- ✅ 改进的状态机架构，更流畅的动画过渡
- ✅ 重新设计的UI控件，毛玻璃效果按钮
- ✅ 优化的背景层叠混合算法
- ✅ 智能提示系统，呼吸灯效果

### v1.1.0
- ✅ 新增自动播放功能，支持名言自动轮播
- ✅ 实现基础动画效果（完整显示→淡出→淡入）
- ✅ 支持背景50%混合渐变过渡
- ✅ 添加播放控制按钮，支持播放/暂停
- ✅ 智能暂停机制，自动回归完整显示状态
- ✅ 可配置的动画时间参数

### v1.0.0
- ✅ 基础功能实现
- ✅ 智能名言选择算法
- ✅ 自动字体和背景优化
- ✅ 设置页面和用户配置
- ✅ 响应式UI设计
- ✅ 完整的错误处理机制

## 许可证

本项目采用 MIT 许可证，详情请参见 LICENSE 文件。

## 贡献

欢迎提交 Issue 和 Pull Request 来帮助改进这个项目。

## 联系方式

如有问题或建议，请通过 GitHub Issues 联系我们。